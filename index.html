<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Html5-dropzone by stevendwood</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Html5-dropzone</h1>
          <h2></h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/stevendwood/html5-dropzone/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/stevendwood/html5-dropzone/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/stevendwood/html5-dropzone" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a name="html5-dropzone" class="anchor" href="#html5-dropzone"><span class="octicon octicon-link"></span></a>html5 [dropzone]</h1>

<p>A small JavaScript library that provides a usable implementation of the HTML5 <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/interaction.html#the-dropzone-attribute">dropzone</a> attribute, eases implementation of HTML5 drag and drop apps  and gets drag and drop to work in the intended HTML 5 style cross browser.  </p>

<p><a href="http://stevendwood.github.io/html5-dropzone/examples/cards.html">Multiple dropzone demo</a> - This demo is based on a JQuery drag and drop example and shows how you can have different dropzones that can be fussy about what they accept even on IE.  </p>

<p><a href="http://stevendwood.github.io/html5-dropzone/examples/custom-drag-image.html">Custom drag image demo</a> - This demo shows a custom drag image or ghost, works on IE as well despite the lack of a setDragImage function.</p>





<p><strong>Table of Contents</strong>  <em>generated with <a href="http://doctoc.herokuapp.com/">DocToc</a></em></p>

<ul>
<li><a href="#features">Features</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#why-do-i-need-a-library-for-native-drag-and-drop-">Why do i need a library for native drag and drop ?</a></li>
<li>
<a href="#using-dropzone">Using <code>dropzone</code></a>

<ul>
<li><a href="#setting-up-a-dropzone">Setting up a dropzone</a></li>
<li><a href="#styling-the-dropzone">Styling the dropzone</a></li>
<li><a href="#multiple-dropzones">Multiple dropzones</a></li>
</ul>
</li>
<li>
<a href="#drag-sources">Drag sources</a>

<ul>
<li>
<a href="#using-draggable">Using <code>draggable()</code></a>

<ul>
<li><a href="#codesetdatacode"><code>setData()</code></a></li>
<li><a href="#codeeffectallowedcode"><code>effectAllowed()</code></a></li>
<li>
<a href="#customising-the-drag-image">Customising the drag image</a>

<ul>
<li><a href="#codeghostcode"><code>ghost()</code></a></li>
</ul>
</li>
<li><a href="#codeeventgetdropeffectcode"><code>event.getDropEffect()</code></a></li>
</ul>
</li>
</ul>
</li>
</ul><h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<ol>
<li>
<p>Use the dropzone attribute on any element.</p>

<div class="highlight highlight-html"><pre><span class="c">&lt;!-- Accept drops of text/x-paper with a default operation of move --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"paperbin"</span> <span class="na">dropzone=</span><span class="s">"move string:text/x-paper"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="c">&lt;!-- Accept drops of text/x-paper and text/x-apple with a default operation of move --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"trashbin"</span> <span class="na">dropzone=</span><span class="s">"move s:text/x-paper s:text/x-apple"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="c">&lt;!-- Accept any image files and and elements or text from another application that produce text/plain --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">dropzone=</span><span class="s">"copy f:image/* s:text/plain"</span><span class="nt">&gt;&lt;/div&gt;</span>
</pre></div>
</li>
<li>
<p>Store any type of data you like in DataTransfer.setData on Internet Explorer too (not just "Text" and "Url")</p>

<div class="highlight highlight-javascript"><pre>  <span class="nx">onDragStart</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// this now works on IE</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/x-example"</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">);</span>
  <span class="p">}</span>
</pre></div>
</li>
<li>
<p>Reliably read the dropEffect on source elements at the dragend using getDropEffect(). e.g. if you haven't tried to do this :</p>

<div class="highlight highlight-javascript"><pre>  <span class="c1">// implemented on the draggable source</span>
<span class="kd">function</span> <span class="nx">dragStartHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">effectAllowed</span> <span class="o">=</span> <span class="s2">"copyMove"</span>
<span class="p">}</span>

<span class="c1">// implemented on the drop target</span>
<span class="kd">function</span> <span class="nx">dragOverHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">dropEffect</span> <span class="o">=</span> <span class="s2">"move"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">dragEndHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// following a successful drop...</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">dropEffect</span><span class="p">;</span> <span class="c1">// "move" on all browsers except IE which reports "none"</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getDropEffect</span><span class="p">();</span> <span class="c1">// "move" on all browsers</span>
<span class="p">}</span>
</pre></div>
</li>
<li>
<p>Easily accept files*</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">dropzone=</span><span class="s">"copy file:text/csv"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
   document.getElementById("dz").addEventListener("drop", function(event) {
      event.dataTransfer.files; // contains any files dropped,
   });
</pre></div>

<p>*(on Firefox and IE this will allow a drop of any file, on Chrome and Safari it will only cancel the dragover/enter events where the file is actually of text/csv type) However since the dropzone will cancel the dragovers if any file is of type CSV you need
to check the type on drop anyway incase there was more than one file in the drag.</p>
</li>
<li>
<p><code>draggable</code> function to ease working with drag sources and provide custom ghost elements even on Internet Explorer.</p>

<div class="highlight highlight-javascript"><pre>  <span class="c1">// make the element draggable, with two content types, </span>
  <span class="c1">// it can only be copied and it has a custom ghost element function</span>
  <span class="nx">draggable</span><span class="p">(</span><span class="s2">"#dragMe"</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/plain"</span><span class="p">,</span> <span class="s2">"Some plain text"</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/html"</span><span class="p">,</span> <span class="s2">"Some &lt;b&gt;HTML&lt;/b&gt; text"</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">effectAllowed</span><span class="p">(</span><span class="s2">"copy"</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">ghost</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
            <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"p"</span><span class="p">);</span>
            <span class="nx">p</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">"I'm a custom ghost"</span><span class="p">;</span>
            <span class="nx">p</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">"my-custom-ghost"</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">p</span><span class="p">;</span>
        <span class="p">});</span>
</pre></div>
</li>
</ol><p>Allows you to store any data you like in the data transfer object, getting round the major IE limitation which usually only allows "Text" or "Url" in the set/get Data methods.  By using the dropzone attribute, you don't need to implement dragover and dragenter event handlers in order to accept the drop.  You also get some CSS classes added and removed when a drag is over a valid drop target and a valid drop effect is selected. </p>

<p>Supports: IE10+, Chrome, Firefox, Safari</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>This example also uses the <code>draggable</code> function which avoids the need to implement a dragstart listener.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"paper"</span> <span class="na">draggable=</span><span class="s">"true"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"apple"</span> <span class="na">draggable=</span><span class="s">"true"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">dropzone=</span><span class="s">"move s:text/x-paper"</span> <span class="na">ondrop=</span><span class="s">"handleDropPaper(event)"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">dropzone=</span><span class="s">"move s:text/x-apple"</span> <span class="na">ondrop=</span><span class="s">"handleDropApple(event)"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"dropzone.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
      <span class="nx">draggable</span><span class="p">(</span><span class="s2">"#paper"</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/x-paper"</span><span class="p">,</span> <span class="s2">"Data for the x-paper drag type"</span><span class="p">);</span>

      <span class="nx">draggable</span><span class="p">(</span><span class="s2">"#apple"</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/x-apple"</span><span class="p">,</span> <span class="s2">"Data for the x-apple drag type"</span><span class="p">);</span>

      <span class="kd">function</span> <span class="nx">handleDropPaper</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s2">"x-paper"</span><span class="p">);</span> <span class="c1">// "Data for the x-paper drag type"</span>
       <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">handleDropApple</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s2">"x-paper"</span><span class="p">);</span> <span class="c1">// "Data for the x-apple drag type"</span>
      <span class="p">}</span>

<span class="nt">&lt;/script&gt;</span>
</pre></div>

<p>For anyone familiar with the HTML5 drag and drop API, this code is roughly the equivalent of the following code which will not run on IE, and will not handle adding and removing the classes to the drop target elegantly when there are other elements inside the drop target... :</p>

<div class="highlight highlight-html"><pre><span class="c">&lt;!-- (FOR ILLUSTRATION ONLY - DOES NOT WORK !!) --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"paper"</span> <span class="na">draggable=</span><span class="s">"true"</span> <span class="na">ondragstart=</span><span class="s">"startDragPaper(event)"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"apple"</span> <span class="na">draggable=</span><span class="s">"true"</span> <span class="na">ondragstart=</span><span class="s">"startDragApple(event)"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="nt">&lt;div</span>  <span class="na">ondragover=</span><span class="s">"isPaper(event)"</span> <span class="na">ondragenter=</span><span class="s">"isPaper(event)"</span> <span class="na">ondragleave=</span><span class="s">"removeClass(event)"</span> <span class="na">ondrop=</span><span class="s">"handleDropPaper(event)"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;div</span>  <span class="na">ondragover=</span><span class="s">"isApple(event)"</span> <span class="na">ondragenter=</span><span class="s">"isApple(event)"</span> <span class="na">ondragleave=</span><span class="s">"removeClass(event)"</span> <span class="na">ondrop=</span><span class="s">"handleDropApple(event)"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="nt">&lt;script&gt;</span>

      <span class="kd">function</span> <span class="nx">startDragPaper</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This will throw an exception on IE</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/x-paper"</span><span class="p">,</span> <span class="s2">"Data for the x-paper drag type"</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">startDragApple</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This will throw an exception on IE</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/x-apple"</span><span class="p">,</span> <span class="s2">"Data for the x-apple type"</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">isPaper</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">"x-paper"</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">"drag-matches"</span><span class="p">);</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">isApple</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">types</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">"x-apple"</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">"drag-matches"</span><span class="p">);</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">removeClass</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">"drag-matches"</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">function</span> <span class="nx">handleDropPaper</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// will throw an error on IE</span>
         <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s2">"x-paper"</span><span class="p">);</span> <span class="c1">// "Data for the x-paper drag type"</span>
      <span class="p">}</span>

       <span class="kd">function</span> <span class="nx">handleDropApple</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// will throw an error on IE</span>
         <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s2">"x-paper"</span><span class="p">);</span> <span class="c1">// "Data for the x-apple drag type"</span>
      <span class="p">}</span>

<span class="nt">&lt;/script&gt;</span>
</pre></div>

<h2>
<a name="why-do-i-need-a-library-for-native-drag-and-drop-" class="anchor" href="#why-do-i-need-a-library-for-native-drag-and-drop-"><span class="octicon octicon-link"></span></a>Why do i need a library for native drag and drop ?</h2>

<p>I've spent many months toiling with HTML5 drag and drop on different browsers, this library represents the sum of my knowledge on the subject, hopefully it will save anyone using it a lot of time and hassle.  HTML5 drag and drop does not work natively cross browser regardless of the dropzone attribute. </p>

<p><strong>Lots of events</strong></p>

<p>It's clumsy and requires working with lots of events.  For example to allow a user to drag one element and drop it on top of another you need to :</p>

<ol>
<li>Implement the dragstart event.</li>
<li>Implement dragenter and ...</li>
<li>...dragover handlers on the target, at the very least to cancel the events</li>
<li>Implement dragleave if you planned on styling the node on dragover/enter to show it can take the drop.</li>
<li>Implement a drop handler.</li>
</ol><p>The deal is that on dragstart - you put data into the <a href="http://html5index.org/Drag%20and%20Drop%20-%20DataTransfer.html">DataTransfer</a> object, this data is keyed by type - so you can provide a representation in plain text, as HTML or whatever you like.  When a drop happens either in another web page or a native application, the data store will be asked for data according to what the recieving application wants.</p>

<p>dragenter and dragover at least need to be cancelled if you want an element to accept the drop, so you must implement them even if to do nothing other than cancel the drag event.</p>

<p><strong>How to I decide whether to cancel the dragenter/dragover events ?</strong></p>

<p>The default action of the browser in this case is not to allow a drop, so we need to cancel the dragenter/dragover events on any drop target it if we want to change that.  In order to decide whether or not you accept a drop - you need to consider a number of things :</p>

<p><strong>1 Do I recognise the type of what is being dragged</strong> ?</p>

<p>During dragover/enter you get access to a list of strings, these being the types of things that are currently being dragged.  Some browsers provide a list of <a href="http://html5index.org/Drag%20and%20Drop%20-%20DataTransferItem.html">DataTransferItems</a> but some don't.  The data transfer item doesn't help here all that much since you only get told the "kind" of thing in addition to the type - i.e. is it a file or a string.  You cannot see exactly what is being dragged due to security considerations, which is fair enough.  </p>

<p>This is generally workable, <strong>except that in Internet Explorer including version 11 - you cannot store any other information except "Text" and "Url"</strong>.  You therefore have no hope of conditionally accepting a drop if you based your decision solely  on the reported types of what is being dragged.  If you try the examples from the spec. IE will throw an exception as soon as you try and store something that is not "Text" or "Url".  </p>

<p><strong>2 Does the drag source allow the effect I want to apply ?</strong></p>

<p>There are two properties of interest here - effectAllowed and dropEffect. The general idea seems to be that the source of a drag indicates (by setting effectAllowed) that it can be (e.g.) moved and copied, or that it can only be copied.  The drop target can specify which action it wants to take on dragover by setting the dropEffect, e.g. if it sets the dropEffect to link and the effectAllowed is "move" - then it would seem reasonable that the drop should not be allowed.  This is how all browsers except IE work.  This library fixes this behaviour on IE.</p>

<p><strong>Drop Effect and Effect Allowed</strong>
You can set effectAllowed ondragstart, and dropEffect on dragover.  The information below is regardless
of whether you cancel the appropriate events to indicate you accept the drop.  You must cancel the dropevent in order for the dropEffect to be passed to the dragend function.</p>

<p>There are three things to consider :</p>

<p><strong>2.1 Should the drop be accepted only if the dropEffect set to a valid value given the effectAllowed ?</strong></p>

<p>If the dropEffect is not one of the effectAllowed values, then all browsers except IE do not accept the drop. IE allows any drop regardless of the dropEffect and the effectAllowed (this library fixes this).</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// implemented on the draggable source</span>
<span class="kd">function</span> <span class="nx">dragStartHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">effectAllowed</span> <span class="o">=</span> <span class="s2">"copyMove"</span>
<span class="p">}</span>

<span class="c1">// implemented on the drop target</span>
<span class="kd">function</span> <span class="nx">dragOverHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">dropEffect</span> <span class="o">=</span> <span class="s2">"link"</span><span class="p">;</span>
   <span class="p">...</span>
<span class="p">}</span>
</pre></div>

<p>In the above example the drop target cannot accept the drop as it does not specify a valid dropEffect.  This would not normally work on IE but by using this library the above code will result in the drop not being allowed on any browser.</p>

<p><strong>2.2 Does the cursor update to give the user feedback on what will happen if they drop ?</strong></p>

<p>Chrome &amp; Safari will change the mouse cursor to fit the dropEffect. So does Mozilla on mac. Mozilla on windows and IE both look at the first effect they come across in the effectAllowed and set the cursor on any valid drop target to be that. Except IE who seem to always use "link" if that is in the effectAllowed e.g. if effectAllowed is "copyLink" and we set dropEffect to "link" on dragover - Mozilla will set the
cursor to "copy" but IE set it to "link".  IE seems to have "link" as always winning. When you press ctrl, mozilla update the cursor in response. So it seems you cannot programatically affect the cursor in Mozilla by changing the drop effect in dragover.</p>

<p><strong>2.3 Is the dropEffect reported at the source element on dragend ?</strong></p>

<p>The spec shows that the source can listen for the dragend event to see what happened.  It should look at the dropEffect within this event. Chrome, Mozilla and Safari work as you would hope here, the drop effect appears in the dragend event. In IE if the effect allowed is a simple value e.g. "copy" then any successful drop results in this value  appearing as the dropEffect on dragend.  If the effectAllowed was a compound value like "copyMove" and the drop target tried to select "move" on dragover by setting the dropEffect, you're out of luck, that will come through as  dropEffect = "none" at the source on dragend.   </p>

<div class="highlight highlight-javascript"><pre><span class="c1">// implemented on the draggable source</span>
<span class="kd">function</span> <span class="nx">dragStartHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">effectAllowed</span> <span class="o">=</span> <span class="s2">"move"</span>
<span class="p">}</span>

<span class="c1">// implemented on the drop target</span>
<span class="kd">function</span> <span class="nx">dragOverHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">dropEffect</span> <span class="o">=</span> <span class="s2">"move"</span><span class="p">;</span>
   <span class="p">...</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">dragEndHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// following a successful drop...</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">dropEffect</span><span class="p">;</span> <span class="c1">// "move" on all browsers</span>
<span class="p">}</span>

</pre></div>

<p>But, supposing we tried this</p>

<div class="highlight highlight-javascript"><pre><span class="c1">// implemented on the draggable source</span>
<span class="kd">function</span> <span class="nx">dragStartHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">effectAllowed</span> <span class="o">=</span> <span class="s2">"copyMove"</span>
<span class="p">}</span>

<span class="c1">// implemented on the drop target</span>
<span class="kd">function</span> <span class="nx">dragOverHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">dropEffect</span> <span class="o">=</span> <span class="s2">"move"</span><span class="p">;</span>
   <span class="p">...</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">dragEndHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// following a successful drop...</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">dropEffect</span><span class="p">;</span> <span class="c1">// "move" on all browsers except IE which reports "none"</span>
<span class="p">}</span>

</pre></div>

<p>Then the dropEffect is reported as "none" on IE, but is correctly reported on the other browsers. To fix this I introduced a new method you can call called getDropEffect() :</p>

<div class="highlight highlight-javascript"><pre><span class="kd">function</span> <span class="nx">dragEndHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// following a successful drop...with effectAllowed set to copyMove</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">dropEffect</span><span class="p">;</span> <span class="c1">// "move" on all browsers except IE which reports "none"</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getDropEffect</span><span class="p">();</span> <span class="c1">// "move" on all browsers.</span>
<span class="p">}</span>
</pre></div>

<p><strong>Other notes</strong></p>

<p>On Safari on a mac - effectAllowed cannot be set programatically, therefore any dropEffect that gets set is valid. When you press the cmd key the effectAllowed becomes "move" and when you press the alt key the effectAllowed becomes "copy".  Thereafter it works as you would hope, if the dropEffect is not one of these effectAlloweds the drop is not allowed by the browser.  </p>

<p><strong>What does all this mean ?</strong></p>

<p>Should the "operation" part of the dropzone be used to set the drop effect ?  My conclusion was yes, provided that keyboard shortcuts can change it - i.e. if you do nothing you get the operation, otherwise you get the operation as specified by the keyboard. So for a drop zone with "move" then if you do not use the keyboard, you get a dropEffect of move, otherwise the dropEffect is selected based on the keyboard modifiers.  If this produces a disallowed effectAllowed the drop will not be acceptable.</p>

<p>You also get a class added ondragover reflecting the dropEffect -  drag-matches.copy  drag-matches.move or drag-matches.link. </p>

<h2>
<a name="using-dropzone" class="anchor" href="#using-dropzone"><span class="octicon octicon-link"></span></a>Using <code>dropzone</code>
</h2>

<p>The dropzone attribute makes an element able to accept drops. If an element has a dropzone attribute, this will be parsed and used to decide whether or not to cancel the drag events required to tell the browser a drop is accepted.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">dropzone=</span><span class="s">"copy s:text/plain s:text/x-my-custom-type"</span> <span class="na">ondrop=</span><span class="s">"handleDrop(event)"</span><span class="nt">&gt;&lt;/div&gt;</span>
</pre></div>

<p>This example will make the element accept any drag that contains data text/plain or text/x-my-custom-type. </p>

<h3>
<a name="setting-up-a-dropzone" class="anchor" href="#setting-up-a-dropzone"><span class="octicon octicon-link"></span></a>Setting up a dropzone</h3>

<p>This simple example allows the user to drag the element with id "paper" and drop it on the div with id "trashcan".  Using this library (and the dropzone attribute), there is no need to cancel the dragenter and dragover events and provide styling in the dragenter/dragleave events.</p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"paper"</span> <span class="na">draggable=</span><span class="s">"true"</span> <span class="na">ondragstart=</span><span class="s">"startDrag(event)"</span><span class="nt">&gt;</span>I'm a bit of paper<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"trashcan"</span> <span class="na">dropzone=</span><span class="s">"move string:text/x-paper"</span> <span class="na">ondrop=</span><span class="s">"handleDrop(event)"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="nt">&lt;script&gt;</span>
  <span class="kd">function</span> <span class="nx">startDrag</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/x-paper"</span><span class="p">,</span> <span class="s2">"put whatever you like in here"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">handleDrop</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">paper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#paper"</span><span class="p">)</span>
      <span class="nx">paper</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">paper</span><span class="p">);</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>

<p>Using the dropzone attribute on an element passed to the dropzone function will automatically cancel any dragover events where the data being dragged matches the dropzone specification.  The above example will work on Internet Explorer as well despite the custom type used in the setData call.</p>

<p>If you don't like the dropzone attribute or prefer to use unobtrusive JavaScript :</p>

<div class="highlight highlight-javascript"><pre><span class="nx">dropzone</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#trashcan"</span><span class="p">),</span> <span class="s2">"move s:text/x-paper"</span><span class="p">);</span>

<span class="c1">// or....</span>

<span class="nx">dropzone</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#trashcan"</span><span class="p">),</span> <span class="p">{</span>
    <span class="nx">operation</span><span class="o">:</span> <span class="s2">"copy"</span><span class="p">,</span>
    <span class="nx">accepts</span><span class="o">:</span> <span class="p">[{</span>
        <span class="nx">kind</span><span class="o">:</span> <span class="s2">"string"</span><span class="p">,</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s2">"text/x-paper"</span>
    <span class="p">}]</span>  
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"drop"</span><span class="p">,</span> <span class="nx">handleDrop</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">handleDrop</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">paper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#paper"</span><span class="p">);</span>
    <span class="nx">paper</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">paper</span><span class="p">);</span>
<span class="p">}</span>

</pre></div>

<h3>
<a name="styling-the-dropzone" class="anchor" href="#styling-the-dropzone"><span class="octicon octicon-link"></span></a>Styling the dropzone</h3>

<p>Whenever the user drags something that matches over the dropzone, the class <code>drag-matches</code> is added to the target.  One (of many) annoying issue(s) when using drag and drop is that if the drop target contains other child elements, <a href="http://stackoverflow.com/questions/7110353/html5-dragleave-fired-when-hovering-a-child-element">the dragleave event will fire when you go over the child</a>, however the <code>drag-matches</code> class is only added or removed when you enter or leave the drop target, much the same as mousenter/works.   The following CSS classes are added to dropzones :</p>

<ol>
<li>
<code>drag-matches</code> Added when the dropzone can accept a drop.</li>
<li>
<code>copy</code> Added when drag matches and the dropEffect is copy.</li>
<li>
<code>move</code> Added when drag matches and the dropEffect is move.</li>
<li>
<code>link</code> Added when drag matches and the dropEffect is link.</li>
</ol><h3>
<a name="multiple-dropzones" class="anchor" href="#multiple-dropzones"><span class="octicon octicon-link"></span></a>Multiple dropzones</h3>

<p>Now we can setup a 2nd dragsource and dropzone.  The 2nd dragsource is an apple, and since apples cannot go into a trashcan for paper, we need a 2nd dropzone.  This example demonstrates how dropzones can selectively accept or reject based on what is being dragged. Note that the recycle bin can accept either the paper or the apple but the paper bin can only accept the paper. </p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"paper"</span> <span class="na">draggable=</span><span class="s">"true"</span> <span class="na">ondragstart=</span><span class="s">"startDragPaper(event)"</span><span class="nt">&gt;</span>I'm a bit of paper, drag me to the bin<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"apple"</span> <span class="na">draggable=</span><span class="s">"true"</span> <span class="na">ondragstart=</span><span class="s">"startDragApple(event)"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"paperbin"</span> <span class="na">dropzone=</span><span class="s">"move string:text/x-paper"</span> <span class="na">ondrop=</span><span class="s">"handleDropPaper(event)"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"recyclebin"</span> <span class="na">dropzone=</span><span class="s">"move s:text/x-apple s:text/x-paper"</span> <span class="na">ondrop=</span><span class="s">"handleDropApple(event)"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="nt">&lt;script&gt;</span>

  <span class="kd">function</span> <span class="nx">startDragPaper</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/x-paper"</span><span class="p">,</span> <span class="s2">"put whatever you like in here"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">startDragApple</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/x-apple"</span><span class="p">,</span> <span class="s2">"put whatever you like in here"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// drop handlers not shown</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>

<h2>
<a name="drag-sources" class="anchor" href="#drag-sources"><span class="octicon octicon-link"></span></a>Drag sources</h2>

<h3>
<a name="using-draggable" class="anchor" href="#using-draggable"><span class="octicon octicon-link"></span></a>Using <code>draggable()</code>
</h3>

<p>Depending on what you want to do, you don't have to use this function at all, however, if you want a customised drag image to work cross browser (read on IE) then you do need to use it.</p>

<p>The draggable function lets you specify nodes that can be dragged, what gets put into the data transfer, what the allowed effects are and a way to customise the drag image.  </p>

<div class="highlight highlight-html"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"draggable"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
    <span class="nx">draggable</span><span class="p">(</span><span class="s2">"#draggable"</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/x-my-type"</span><span class="p">,</span> <span class="s2">"Some text"</span><span class="p">)</span>
       <span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/html"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s2">"some &lt;b&gt;HTML&lt;/b&gt; content"</span><span class="p">;</span> <span class="p">})</span>
       <span class="p">.</span><span class="nx">effectAllowed</span><span class="p">(</span><span class="s2">"copyMove"</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>

<p>The above is equivalent to :</p>

<div class="highlight highlight-javascript"><pre><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"draggable"</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"dragstart"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/x-my-type"</span><span class="p">,</span> <span class="s2">"Some text"</span><span class="p">);</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/html"</span><span class="p">,</span> <span class="s2">"some &lt;b&gt;HTML&lt;/b&gt; content"</span><span class="p">);</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">effectAllowed</span> <span class="o">=</span> <span class="s2">"copyMove"</span><span class="p">;</span>
  <span class="p">});</span>
</pre></div>

<p>The above sample will not work cross browser without this library but it will once you use it so you don't have to use draggable for the above if you don't want to.  One other thing is that the value you provide for a type can be a string value or a function that produces a string.  if it's a function, it gets called when the drag starts.</p>

<h4>
<a name="setdata" class="anchor" href="#setdata"><span class="octicon octicon-link"></span></a><code>setData()</code>
</h4>

<p>Equivalent to the DataTransfer.setData function, but saves you having to implement dragstart.  The 2nd param can be a string or a function that produces a string, gets called on drag start.</p>

<h4>
<a name="effectallowed" class="anchor" href="#effectallowed"><span class="octicon octicon-link"></span></a><code>effectAllowed()</code>
</h4>

<p>Equivalent to setting the DataTransfer.effectAllowed property, but saves you having to implement dragstart.  The 2nd param can be a string or a function that produces a string, gets called on drag start.</p>

<h4>
<a name="customising-the-drag-image" class="anchor" href="#customising-the-drag-image"><span class="octicon octicon-link"></span></a>Customising the drag image</h4>

<p>One of the major holes of the IE implementation is the inability to provide a custom drag image.  The spec actually allows you to use a DOM element as the custom drag image, the trick being that it has to be visible.  To provide a custom drag image use the "ghost" function.  e.g consider a multi-select list.  If the user selects more than one thing, then we need to be able to indicate in the drag that more than one thing is being dragged.  In this example we provide a custom ghost image that addes into a UL a clone of all the list items having the "selected" class.</p>

<h5>
<a name="ghost" class="anchor" href="#ghost"><span class="octicon octicon-link"></span></a><code>ghost()</code>
</h5>

<p><a href="http://stevendwood.github.io/html5-dropzone/examples/custom-drag-image.html">Custom drag image demo</a></p>

<p>The ghost function takes as an argument either a DOM node or a function that produces a DOM node and is called at drag start.  Typically this will be used in setDragImage for browsers that support.  Using this function allows you to supply any DOM node (doesn't have to be on the page).  e.g. :</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">listItems</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s2">"li"</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>

<span class="nx">listItems</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">li</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">li</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="s2">"selected"</span><span class="p">);</span>
    <span class="p">});</span>


    <span class="nx">draggable</span><span class="p">(</span><span class="nx">li</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"fruits"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">[].</span><span class="nx">map</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s2">".fruits li.selected"</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
            <span class="p">});</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">ghost</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">dragImg</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"ul"</span><span class="p">);</span>
            <span class="p">[].</span><span class="nx">forEach</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s2">".fruits li.selected"</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">li</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">dragImg</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
            <span class="p">});</span>

            <span class="k">return</span> <span class="nx">dragImg</span><span class="p">;</span>
        <span class="p">});</span>
<span class="p">});</span>


<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"dropZone"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"drop"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s2">"fruits"</span><span class="p">);</span>
    <span class="p">});</span>

</pre></div>

<p>This produces the following :</p>

<p><a href="http://stevendwood.github.io/html5-dropzone/examples/multi-select.html">Custom drag image demo</a></p>

<h4>
<a name="eventgetdropeffect" class="anchor" href="#eventgetdropeffect"><span class="octicon octicon-link"></span></a><code>event.getDropEffect()</code>
</h4>

<p>If you want to use the browsers native dropEffect property reliably to do something to the source element based on dropEffect - then you must allow only one effectAllowed copy, move or link if you do not set it it will become "copy".  Otherwise you should use the getDropEvent function in the dragend handler which reliably works in IE for compund values of the effectAllowed property.</p>

<div class="highlight highlight-html"><pre>
<span class="nt">&lt;ol</span> <span class="na">dropzone=</span><span class="s">"move string:text/x-example"</span> <span class="na">ondragstart=</span><span class="s">"dragStartHandler(event)"</span> <span class="na">ondragend=</span><span class="s">"dragEndHandler(event)"</span><span class="nt">&gt;</span>

<span class="nt">&lt;script&gt;</span>
   <span class="cm">/*</span>
<span class="cm">       On drag start we allow the element to be moved or copied, on drag end we want to</span>
<span class="cm">       remove the element if the selected dropEffect was "move". Because we used a </span>
<span class="cm">       'compound' effectAllowed (copyMove), Internet Explorer unforunately reports that</span>
<span class="cm">       the dropEffect was "none" on the dragend no matter what we set it to on dragover.</span>
<span class="cm">       The effect will be set on the dropzone based on the keyboard modifiers, if none</span>
<span class="cm">       were used, we get the default for the dropzone which was "move" in the markup above.</span>
<span class="cm">    */</span>
   <span class="kd">function</span> <span class="nx">dragStartHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="k">instanceof</span> <span class="nx">HTMLLIElement</span><span class="p">)</span> <span class="p">{</span>

         <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s2">"text/x-my-type"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
         <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">effectAllowed</span> <span class="o">=</span> <span class="s1">'copyMove'</span><span class="p">;</span> <span class="c1">// only allow copies or moves</span>
      <span class="p">}</span> 
    <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">dragEndHandler</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// use this instead of event.datatTransfer.dropEffect</span>
    <span class="kd">var</span> <span class="nx">dropEffect</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">getDropEffect</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">dropEffect</span> <span class="o">===</span> <span class="s2">"move"</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">parentElement</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>

</pre></div>
        </section>

        <footer>
          Html5-dropzone is maintained by <a href="https://github.com/stevendwood">stevendwood</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>